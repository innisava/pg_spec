# Установка и настройка PostgreSQL на удалённом хосте

## Описание

Консольное Bash-приложение для автоматической установки, настройки и запуска PostgreSQL на удалённом сервере (Debian или CentOS/AlmaLinux). Сценарий выбирает наименее загруженный сервер из двух доступных и производит все необходимые действия.

## Возможности

- Подключение к удалённым хостам по SSH
- Сравнение загруженности серверов (`uptime`)
- Установка PostgreSQL на целевой сервер
- Конфигурация для внешнего подключения к БД
- Создание пользователя `student`, доступного только с одного из серверов
- Проверка соединения с помощью SQL-запроса `SELECT 1`

## Требования

- Язык разработки: **Bash**
- SSH доступ к серверам под root с приватным ключом
- Приложение принимает один строковый параметр - ip адреса или имена серверов одной строкой, разделитель - запятая
- Приложение должно сообщать статус выполнения инсталляции
- Приложение выполняет проверку работы БД, выполняя sql запрос (SELECT 1)

## Установка и запуск

### 1. **Клонировать репозиторий:**
```shell
git clone https://github.com/innisava/pg_spec
cd pg_spec
```
### 2. **Права на выполнение:**
```shell
chmod +x pg_setup.sh
```
### 3. **Запуск скрипта:**
```shell
 ./pg_setup.sh "IP_1,IP_2" [--key /path_private_key]
```
### **Пример запуска**
```shell
./pg_setup.sh 192.168.59.100,192.168.59.101 --key ~/.ssh/id_rsa_postgres
```
### **Логика работы**

1. Проверяет доступность серверов
2. Сравнивает нагрузку (по uptime)
3. Устанавливает PostgreSQL на выбранный сервер
4. Настраивает:
+ Внешний доступ
+ Пользователя student с IP-ограничением
5. Проверяет работу через SELECT 1

### **Результат**
```shell
[SUCCESS] Подключение успешно!
[DONE] PostgreSQL установлен и настроен на <IP>
```
> *Примечание:
> Скрипт автоматически открывает порт 5432 в firewalld, если он активен.*

## Вопросы и решения

**Проблема:** Ошибка `bash: строка 1: psql: команда не найдена`  
**Решение:** Автоматизирована установка клиента через скрипт

**Проблема:** PostgreSQL не слушает внешние подключения  
**Решение:** Настройка `listen_addresses = '*'` в `postgresql.conf`  

> *Примечание:
> Потребовалось дополнительное время для реализации кросс-платформенного решения из-за разных путей к конфигурационным файлам в Debian и CentOS.*
