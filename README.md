# Установка и настройка PostgreSQL на удалённом хосте через SSH

## Описание

Консольное Bash-приложение для автоматической установки, настройки и запуска PostgreSQL на удалённом сервере (Debian или CentOS/AlmaLinux). Сценарий выбирает наименее загруженный сервер из двух доступных и производит все необходимые действия.

## Возможности

- Подключение к удалённым хостам по SSH
- Сравнение загруженности серверов (`uptime`)
- Установка PostgreSQL на целевой сервер
- Конфигурация для внешнего подключения к БД
- Создание пользователя `student`, доступного только с одного из серверов
- Проверка соединения с помощью SQL-запроса `SELECT 1`

## Требования

- Язык разработки: **Bash**
- SSH доступ к серверам под root с приватным ключом
- Приложение принимает один строковый параметр - ip адреса или имена серверов одной строкой, разделитель - запятая
- Приложение должно сообщать статус выполнения инсталляции
- Приложение выполняет проверку работы БД, выполняя sql запрос (SELECT 1)

## Установка и запуск

### 1. **Клонировать репозиторий:**
```shell
git clone https://github.com/innisava/pg_spec
cd postgresql-installer
```
### 2. **Права на выполнение:**
```shell
chmod +x install_postgres.sh
```
### 3. **Запуск скрипта:**
```shell
 bash install_postgres.sh "IP_1,IP_2" [--key /path/private_key]
```
### **Пример запуска**
```shell
./pg_setup.sh 192.168.59.100,192.168.59.101 --key ~/.ssh/id_rsa_postgres
```
### **Что делает скрипт?**
1. Проверяет наличие psql клиента на обоих серверах, при необходимости устанавливает
2. Сравнивает нагрузку на серверах и выбирает наименее нагруженный
3. Устанавливает PostgreSQL и настраивает конфигурационные файлы
4. Создаёт пользователя student, доступного только с другого сервера
5. Проверяет соединение с БД через SELECT 1

### **Результат**
```shell
[SUCCESS] Подключение успешно!
[DONE] PostgreSQL установлен и настроен на <IP>
```
**Примечание**
Скрипт автоматически открывает порт 5432 в firewalld, если он активен.

## Вопросы и решения

**Проблема:** Ошибка `bash: строка 1: psql: команда не найдена`  
**Решение:** Автоматизирована установка клиента через скрипт

**Проблема:** PostgreSQL не слушает внешние подключения  
**Решение:** Настройка `listen_addresses = '*'` в `postgresql.conf`  

> *Примечание: Потребовалось дополнительное время для реализации кросс-платформенного решения из-за разных путей к конфигурационным файлам в Debian и CentOS.*
